---
author: Velox
pubDatetime: 2026-02-22T20:00:00Z
title: ğŸš€ èµ›åšå†™ä½œæµå®Œå…¨ä½“ï¼šç”¨ TG æœºå™¨äººå’Œ Cloudflare Workers é‡æ„æˆ‘çš„ Astro åšå®¢
postSlug: serverless-astro-tg-workflow
featured: true
draft: false
tags:
  - Astro
  - Serverless
  - Telegram
  - Cloudflare
  - æå®¢æŠ˜è…¾
description: æ”¾å¼ƒä¼ ç»Ÿå›¾åºŠå’Œæ‰‹åŠ¨ Git æäº¤ï¼ä»Šå¤©åˆ†äº«æˆ‘æ˜¯å¦‚ä½•åˆ©ç”¨ Serverless é­”æ³•ï¼ŒæŠŠæˆ‘çš„ Astro åšå®¢æ‰“é€ æˆåªéœ€ Ctrl+V å°±èƒ½ä¸€é”®é…å›¾å‘æ–‡çš„â€œèµ›åšç”Ÿäº§åŠ›æµæ°´çº¿â€ã€‚
---

> è¿˜åœ¨æ‰‹åŠ¨ git add/commit/pushï¼Ÿè¿˜åœ¨æ‰“å¼€ç½‘é¡µæ‹–æ‹½ä¸Šä¼ å›¾ç‰‡ï¼Ÿå¤§äººï¼Œæ—¶ä»£å˜äº†ï¼ä»Šå¤©åˆ†äº«æˆ‘æ˜¯å¦‚ä½•åˆ©ç”¨ Serverless é­”æ³•ï¼ŒæŠŠæˆ‘çš„ [Astro](https://astro.build/) åšå®¢æ‰“é€ æˆä¸€ä¸ªå…¨è‡ªåŠ¨åŒ–çš„â€œèµ›åšç”Ÿäº§åŠ›æµæ°´çº¿â€ã€‚

ä½œä¸ºä¸€åè¿½æ±‚æè‡´æ•ˆç‡çš„æå®¢ï¼Œæˆ‘æ— æ³•å¿å—å†™åšå®¢æ—¶ä»»ä½•æ‰“æ–­å¿ƒæµçš„æ‘©æ“¦åŠ›ã€‚ä¼ ç»Ÿçš„åšå®¢å·¥ä½œæµï¼ˆå†™ Markdown -> æ‰“å¼€å›¾åºŠç½‘é¡µä¼ å›¾ -> å¤åˆ¶é“¾æ¥ -> å›åˆ°ç¼–è¾‘å™¨ç²˜è´´ -> æ‰‹åŠ¨ Git æ¨é€ï¼‰ç®€ç›´æ˜¯çµæ„Ÿæ€æ‰‹ã€‚

äºæ˜¯ï¼Œæˆ‘å†³å®šåˆ©ç”¨ **[Cloudflare Workers](https://workers.cloudflare.com/)** å’Œ **Telegram Bot**ï¼Œé‡æ„è¿™ä¸€åˆ‡ã€‚

æˆ‘çš„ç›®æ ‡å¾ˆæ˜ç¡®ï¼š**åŒæ‰‹ä¸ç¦»é”®ç›˜ï¼Œåœ¨ä¸€ä¸ªèŠå¤©çª—å£å†…å®Œæˆå›¾æ–‡åˆ›ä½œå’Œå‘å¸ƒã€‚**

---

## ğŸ› ï¸ æ ¸å¿ƒæ¶æ„ï¼šæç®€ä¸”å¼ºå¤§

æˆ‘çš„è¿™å¥—â€œèµ›åšæµæ°´çº¿â€ç”±ä¸¤ä¸ªæ ¸å¿ƒçš„ Telegram æœºå™¨äººæ„æˆï¼Œå®ƒä»¬èƒŒåéƒ½è¿è¡Œåœ¨ Cloudflare å¼ºå¤§çš„å…¨çƒ Serverless ç½‘ç»œä¸Šï¼š

1.  **ğŸ§  å†™ä½œåŠ©ç†æœºå™¨äºº**ï¼šè´Ÿè´£æ¥æ”¶æˆ‘çš„çµæ„Ÿç¢ç‰‡ï¼Œè°ƒç”¨ AI æ¨¡å‹è¿›è¡Œæ¶¦è‰²æ’ç‰ˆï¼Œè‡ªåŠ¨ç”Ÿæˆå¸¦æœ‰ Frontmatter çš„ Markdown æ–‡ä»¶ï¼Œå¹¶ç›´æ¥æ¨é€åˆ° GitHub ä»“åº“ï¼Œè§¦å‘ [Cloudflare Pages](https://pages.cloudflare.com/) çš„è‡ªåŠ¨æ„å»ºã€‚
2.  **ğŸ“¸ å›¾åºŠç›´ä¼ æœºå™¨äºº**ï¼šè¿™æ˜¯ä»Šå¤©åˆšç«£å·¥çš„é‡å¤´æˆï¼è´Ÿè´£è§£å†³æœ€å¤´ç–¼çš„é…å›¾é—®é¢˜ã€‚

---

## âš¡ï¸ å®æˆ˜å±•ç¤ºï¼šåªè¦ 1 ç§’çš„æé€Ÿå›¾åºŠä½“éªŒ

ä»¥å‰ä¸ºäº†ç»™æ–‡ç« é…ä¸€å¼ å›¾ï¼Œæˆ‘è¦åˆ‡å‡ºç¼–è¾‘å™¨ï¼Œæ‰“å¼€æµè§ˆå™¨ï¼Œè®¿é—®æˆ‘çš„å›¾åºŠä¸»ç«™ï¼Œæ‹–æ‹½ä¸Šä¼ ï¼Œç­‰å¾…ï¼Œç„¶åå¤åˆ¶é“¾æ¥ã€‚

**ç°åœ¨ï¼Ÿæˆ‘åªéœ€è¦åšä¸€ä¸ªåŠ¨ä½œï¼šCtrl+Vã€‚**

æˆ‘å°†æˆ‘çš„â€œæ–‡ä»¶ä¼ è¾“åŠ©æ‰‹â€æ”¹é€ æˆäº† R2 ç›´ä¼ æœºå™¨äººã€‚æˆ‘æŠŠæˆªå›¾ç²˜è´´ç»™å®ƒï¼Œå®ƒèƒŒåçš„ Worker ä¼šç¬é—´æŠŠå›¾ç‰‡äºŒè¿›åˆ¶æµå¡è¿›æˆ‘çš„ Cloudflare R2â€œç»´æ´›å…‹æ–¯â€å­˜å‚¨æ¡¶ï¼Œå¹¶åˆ©ç”¨ R2 çš„å…¬å…±åŠ é€ŸåŸŸåç”Ÿæˆé“¾æ¥ã€‚

ä¸ºäº†è¿½æ±‚æè‡´çš„ä½“éªŒï¼Œæˆ‘ç”šè‡³ç»™ä»£ç åŠ ä¸Šäº†â€œè±ªååŒæ˜¾â€åŠŸèƒ½ã€‚çœ‹çœ‹è¿™æ€§æ„Ÿçš„éƒ¨ç½²ä»£ç ï¼š

![Worker éƒ¨ç½²ä»£ç æˆªå›¾](https://pub-65eb3861e8d64d24a3280e55bd221735.r2.dev/blog-img-1771759137457.jpg)
*ğŸ‘† æ ¸å¿ƒé­”æ³•ï¼šåˆ©ç”¨ Worker æ¥æ”¶ TG å›¾ç‰‡æµå¹¶ç›´ä¼  R2 å­˜å‚¨æ¡¶*

éƒ¨ç½²å®Œæˆåï¼Œå®é™…ä½“éªŒç®€ç›´çˆ½åˆ°é£èµ·ï¼æœºå™¨äººä¸ä»…ä¼šç§’å›ä¸€ä¸ªæ–¹ä¾¿å†™åšå®¢çš„ Markdown ä»£ç å—ï¼ŒTelegram è¿˜ä¼šè‡ªåŠ¨æŠ“å–é“¾æ¥ç”Ÿæˆä¸€å¼ è¶…å¤§çš„å®æ—¶é¢„è§ˆå›¾ï¼Œå®‰å…¨æ„Ÿæ‹‰æ»¡ï¼

çœ‹çœ‹è¿™ä¸æ»‘çš„æ•ˆæœï¼š

![TG æœºå™¨äººå›å¤æ•ˆæœ](https://pub-65eb3861e8d64d24a3280e55bd221735.r2.dev/blog-img-1771767526587.jpg)
*ğŸ‘† æœ€ç»ˆå½¢æ€ï¼šå‘å›¾å³å¾— Markdown æºç ï¼Œå¤–å¸¦è¶…å¤§é¢„è§ˆå›¾*

### ğŸ’» é™„å½•ï¼šæ ¸å¿ƒ Worker æºç 

åˆ†äº«ä¸€ä¸‹æˆ‘æ‰“ç£¨å¥½çš„ R2 å›¾åºŠæœºå™¨äººçš„å®Œæ•´ Cloudflare Worker ä»£ç ã€‚è¿™æ®µä»£ç å®ç°äº†â€œéå›¾ç‰‡æ¶ˆæ¯é™é»˜â€ã€â€œè‡ªåŠ¨æå–æœ€é«˜ç”»è´¨åŸå›¾â€ä»¥åŠâ€œè¿”å›çº¯å‡€ç‰ˆç›´è¿é“¾æ¥â€çš„æ ¸å¿ƒåŠŸèƒ½ã€‚

```javascript
export default {
  async fetch(request, env) {
    // 1. éªŒè¯ POST è¯·æ±‚
    if (request.method !== "POST") return new Response("ğŸš€ Velox çš„ R2 å›¾åºŠæé€Ÿé€šé“å·²å°±ç»ªï¼");

    let update;
    try {
      update = await request.json();
    } catch (e) {
      return new Response("OK");
    }

    // 2. æ ¸å¿ƒé€»è¾‘ï¼šå¦‚æœæ²¡æœ‰æ”¶åˆ°æ¶ˆæ¯ï¼Œæˆ–è€…æ”¶åˆ°çš„ä¸æ˜¯å›¾ç‰‡ï¼Œç›´æ¥é™é»˜æ”¾è¡Œï¼ˆä¸æ‰“æ‰°å½“å¤‡å¿˜å½•ç”¨ï¼‰
    if (!update.message || !update.message.photo) {
      return new Response("OK");
    }

    const chatId = update.message.chat.id;
    // è·å– TG å‹ç¼©æ•°ç»„é‡Œæœ€åä¸€å¼ ï¼ˆåˆ†è¾¨ç‡æœ€é«˜ï¼‰çš„å›¾ç‰‡
    const photo = update.message.photo[update.message.photo.length - 1];
    const fileId = photo.file_id;

    try {
      // 3. å‘ TG ç´¢è¦çœŸå®ä¸‹è½½è·¯å¾„
      const fileRes = await fetch(`https://api.telegram.org/bot${env.TG_BOT_TOKEN}/getFile?file_id=${fileId}`);
      const fileData = await fileRes.json();
      if (!fileData.ok) throw new Error("è·å– TG å›¾ç‰‡è·¯å¾„å¤±è´¥");
      const filePath = fileData.result.file_path;

      // 4. ä¸‹è½½å›¾ç‰‡äºŒè¿›åˆ¶æµ
      const imgRes = await fetch(`https://api.telegram.org/file/bot${env.TG_BOT_TOKEN}/${filePath}`);
      const imgBuffer = await imgRes.arrayBuffer();

      // 5. ç”Ÿæˆæå®¢æ—¶é—´æˆ³æ–‡ä»¶å
      const fileExt = filePath.split('.').pop() || 'png';
      const fileName = `blog-img-${Date.now()}.${fileExt}`;

      // 6. æš´åŠ›å¡å…¥ R2 ç»´æ´›å…‹æ–¯ç½‘ç›˜
      await env.MY_BUCKET.put(fileName, imgBuffer, {
        httpMetadata: { contentType: `image/${fileExt}` }
      });

      // ==========================================
      // âš ï¸ æå…¶å…³é”®ï¼šä¸‹é¢è¿™é‡Œæ¢æˆä½ å›¾åºŠçœŸå®çš„åŠ é€ŸåŸŸå
      const customDomain = "pub-65eb3861e8d64d24a3280e55bd221735.r2.dev"; 
      // ==========================================

      const rawUrl = `https://${customDomain}/${fileName}`;

      // 7. å‘é€æç®€çº¯å‡€ç‰ˆå›å¤ç»™ TG
      await fetch(`https://api.telegram.org/bot${env.TG_BOT_TOKEN}/sendMessage`, {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({
          chat_id: chatId,
          text: `ğŸ“¸ **R2 ç›´ä¼ æˆåŠŸï¼**\n\nğŸŒ **çº¯å‡€é“¾æ¥ (é•¿æŒ‰æˆ–å³é”®å¤åˆ¶)**ï¼š\n${rawUrl}`,
          parse_mode: "Markdown"
        })
      });
      
    } catch (error) {
      await fetch(`https://api.telegram.org/bot${env.TG_BOT_TOKEN}/sendMessage`, {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({
          chat_id: chatId,
          text: `âŒ ç¿»è½¦äº†ï¼š${error.message}`
        })
      });
    }

    return new Response("OK");
  }
};
---

## ğŸ‰ æ€»ç»“ï¼šè¿›å…¥â€œå¿ƒæµâ€å†™ä½œçŠ¶æ€

ç°åœ¨ï¼Œæˆ‘å†™è¿™ç¯‡æ–‡ç« çš„ä½“éªŒæ˜¯è¿™æ ·çš„ï¼š

* åœ¨ Telegram é‡Œæ•²ä¸‹è¿™æ®µæ–‡å­—ã€‚
* éšæ‰‹æˆªå‡ å¼ åˆšæ‰çš„éƒ¨ç½²å›¾ï¼Œç²˜è´´ç»™å›¾åºŠæœºå™¨äººã€‚
* ç‚¹å‡»æœºå™¨äººå›ä¼ çš„ä»£ç å—ï¼Œä¸€é”®å¤åˆ¶å›¾ç‰‡é“¾æ¥æ’åˆ°æ–‡å­—é‡Œã€‚
* ç‚¹å‡»å‘é€ç»™å†™ä½œæœºå™¨äººã€‚

**ä¸€åˆ†é’Ÿåï¼Œä½ ç°åœ¨çœ‹åˆ°çš„è¿™ç¯‡æ–‡ç« å°±è‡ªåŠ¨ä¸Šçº¿äº†ã€‚**

è¿™å°±æ˜¯ Serverless æ—¶ä»£ç»™æå®¢å¸¦æ¥çš„ç»ˆæè‡ªç”±ã€‚ä¸éœ€è¦ç»´æŠ¤æœåŠ¡å™¨ï¼Œä¸éœ€è¦ç¹ççš„æ“ä½œï¼ŒæŠŠä¸€åˆ‡é‡å¤åŠ³åŠ¨éƒ½äº¤ç»™æœºå™¨äººï¼Œè€Œæˆ‘ä»¬ï¼Œåªä¸“æ³¨äºåˆ›é€ ä»·å€¼æœ¬èº«ã€‚ğŸ˜
